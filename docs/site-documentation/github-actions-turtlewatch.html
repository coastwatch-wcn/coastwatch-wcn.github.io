<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>github-actions-turtlewatch – CoastWatch West Code Node</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/coastwatch.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5db250258425642d6fa6ee827e81bb3f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/coastwatch_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">CoastWatch West Code Node</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text"> </span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-access" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Data Access</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-data-access">    
        <li>
    <a class="dropdown-item" href="../data_catalog.html">
 <span class="dropdown-text">Data Catalog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../data_server.html">
 <span class="dropdown-text">Data Server</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tools-and-training" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tools and Training</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-tools-and-training">    
        <li>
    <a class="dropdown-item" href="../tools.html">
 <span class="dropdown-text">Tools</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../training.html">
 <span class="dropdown-text">Training</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../code_gallery.html">
 <span class="dropdown-text">Code Gallery</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../applications.html"> 
<span class="menu-text">Applications</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-about" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">About</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-about">    
        <li>
    <a class="dropdown-item" href="../coastwatch.html">
 <span class="dropdown-text">CoastWatch</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contact_us.html">
 <span class="dropdown-text">Contact Us</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../customer_survey.html">
 <span class="dropdown-text">Customer Survey</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../news_archive.html">
 <span class="dropdown-text">News Archive</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#github-actions-turtlewatch-total-dashboard-auto-update" id="toc-github-actions-turtlewatch-total-dashboard-auto-update" class="nav-link active" data-scroll-target="#github-actions-turtlewatch-total-dashboard-auto-update">GitHub Actions: TurtleWatch TOTAL Dashboard Auto-Update</a>
  <ul class="collapse">
  <li><a href="#where-this-automation-lives" id="toc-where-this-automation-lives" class="nav-link" data-scroll-target="#where-this-automation-lives">Where this automation lives</a></li>
  <li><a href="#when-it-runs" id="toc-when-it-runs" class="nav-link" data-scroll-target="#when-it-runs">When it runs</a>
  <ul class="collapse">
  <li><a href="#scheduled-runs-automatic" id="toc-scheduled-runs-automatic" class="nav-link" data-scroll-target="#scheduled-runs-automatic">1) Scheduled runs (automatic)</a></li>
  <li><a href="#manual-runs-on-demand" id="toc-manual-runs-on-demand" class="nav-link" data-scroll-target="#manual-runs-on-demand">2) Manual runs (on demand)</a></li>
  </ul></li>
  <li><a href="#permissions-why-the-workflow-can-push-commits" id="toc-permissions-why-the-workflow-can-push-commits" class="nav-link" data-scroll-target="#permissions-why-the-workflow-can-push-commits">Permissions (why the workflow can push commits)</a></li>
  <li><a href="#what-the-workflow-does-step-by-step" id="toc-what-the-workflow-does-step-by-step" class="nav-link" data-scroll-target="#what-the-workflow-does-step-by-step">What the workflow does (step-by-step)</a>
  <ul class="collapse">
  <li><a href="#step-1-check-out-the-repository" id="toc-step-1-check-out-the-repository" class="nav-link" data-scroll-target="#step-1-check-out-the-repository">Step 1 — Check out the repository</a></li>
  <li><a href="#step-2-set-up-python" id="toc-step-2-set-up-python" class="nav-link" data-scroll-target="#step-2-set-up-python">Step 2 — Set up Python</a></li>
  <li><a href="#step-3-install-python-dependencies" id="toc-step-3-install-python-dependencies" class="nav-link" data-scroll-target="#step-3-install-python-dependencies">Step 3 — Install Python dependencies</a></li>
  <li><a href="#step-4-install-quarto" id="toc-step-4-install-quarto" class="nav-link" data-scroll-target="#step-4-install-quarto">Step 4 — Install Quarto</a></li>
  <li><a href="#data-update-scripts-what-gets-refreshed" id="toc-data-update-scripts-what-gets-refreshed" class="nav-link" data-scroll-target="#data-update-scripts-what-gets-refreshed">Data update scripts (what gets refreshed)</a></li>
  <li><a href="#step-5-run-total-update-controller" id="toc-step-5-run-total-update-controller" class="nav-link" data-scroll-target="#step-5-run-total-update-controller">Step 5 — Run TOTAL update controller</a></li>
  <li><a href="#step-6-scrape-enso-status" id="toc-step-6-scrape-enso-status" class="nav-link" data-scroll-target="#step-6-scrape-enso-status">Step 6 — Scrape ENSO status</a></li>
  <li><a href="#step-7-scrape-heatwave-status" id="toc-step-7-scrape-heatwave-status" class="nav-link" data-scroll-target="#step-7-scrape-heatwave-status">Step 7 — Scrape Heatwave status</a></li>
  <li><a href="#step-8-update-closure-history-from-federal-register" id="toc-step-8-update-closure-history-from-federal-register" class="nav-link" data-scroll-target="#step-8-update-closure-history-from-federal-register">Step 8 — Update closure history from Federal Register</a></li>
  <li><a href="#rendering-the-website" id="toc-rendering-the-website" class="nav-link" data-scroll-target="#rendering-the-website">Rendering the website</a></li>
  <li><a href="#step-9-render-the-quarto-site" id="toc-step-9-render-the-quarto-site" class="nav-link" data-scroll-target="#step-9-render-the-quarto-site">Step 9 — Render the Quarto site</a></li>
  <li><a href="#committing-and-pushing-the-updated-outputs" id="toc-committing-and-pushing-the-updated-outputs" class="nav-link" data-scroll-target="#committing-and-pushing-the-updated-outputs">Committing and pushing the updated outputs</a></li>
  <li><a href="#step-10-commit-updated-files" id="toc-step-10-commit-updated-files" class="nav-link" data-scroll-target="#step-10-commit-updated-files">Step 10 — Commit updated files</a></li>
  <li><a href="#what-to-expect-after-it-runs" id="toc-what-to-expect-after-it-runs" class="nav-link" data-scroll-target="#what-to-expect-after-it-runs">What to expect after it runs</a></li>
  </ul></li>
  <li><a href="#common-troubleshooting" id="toc-common-troubleshooting" class="nav-link" data-scroll-target="#common-troubleshooting">Common troubleshooting</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="github-actions-turtlewatch-total-dashboard-auto-update" class="level1">
<h1>GitHub Actions: TurtleWatch TOTAL Dashboard Auto-Update</h1>
<p>This repository uses <strong>GitHub Actions</strong> to automatically refresh the TurtleWatch/TOTAL dashboard content on a schedule. The workflow runs a series of Python scripts that <strong>scrape and/or update data</strong>, generate <strong>plots/maps</strong>, then <strong>renders the Quarto website</strong> and commits the updated outputs back to the repository.</p>
<p>The goal is that the live website stays up-to-date <strong>without any manual rerendering</strong>.</p>
<hr>
<section id="where-this-automation-lives" class="level2">
<h2 class="anchored" data-anchor-id="where-this-automation-lives">Where this automation lives</h2>
<p>Workflow file (typically):<br>
<code>.github/workflows/&lt;workflow-name&gt;.yml</code></p>
<p>Workflow name shown in GitHub Actions:<br>
<strong>Update TurtleWatch TOTAL Dashboard</strong></p>
<hr>
</section>
<section id="when-it-runs" class="level2">
<h2 class="anchored" data-anchor-id="when-it-runs">When it runs</h2>
<p>This workflow can run in two ways:</p>
<section id="scheduled-runs-automatic" class="level3">
<h3 class="anchored" data-anchor-id="scheduled-runs-automatic">1) Scheduled runs (automatic)</h3>
<p>It runs <strong>3 times per month</strong> via cron schedules:</p>
<ul>
<li><code>0 12 3 * *</code> → runs on the <strong>3rd</strong> of each month at <strong>12:00 UTC</strong></li>
<li><code>0 12 16 * *</code> → runs on the <strong>16th</strong> of each month at <strong>12:00 UTC</strong></li>
<li><code>0 12 28 * *</code> → runs on the <strong>28th</strong> of each month at <strong>12:00 UTC</strong></li>
</ul>
</section>
<section id="manual-runs-on-demand" class="level3">
<h3 class="anchored" data-anchor-id="manual-runs-on-demand">2) Manual runs (on demand)</h3>
<p><code>workflow_dispatch</code> enables a <strong>Run workflow</strong> button in the GitHub Actions UI so maintainers can run it anytime.</p>
<hr>
</section>
</section>
<section id="permissions-why-the-workflow-can-push-commits" class="level2">
<h2 class="anchored" data-anchor-id="permissions-why-the-workflow-can-push-commits">Permissions (why the workflow can push commits)</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> write</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This grants the workflow permission to commit and push changes back into the repository (required because the workflow updates docs/ and data files).</p>
</section>
<section id="what-the-workflow-does-step-by-step" class="level2">
<h2 class="anchored" data-anchor-id="what-the-workflow-does-step-by-step">What the workflow does (step-by-step)</h2>
<p>The workflow has one job: update, running on an Ubuntu virtual machine:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">update</span><span class="kw">:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="step-1-check-out-the-repository" class="level3">
<h3 class="anchored" data-anchor-id="step-1-check-out-the-repository">Step 1 — Check out the repository</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout repo</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This downloads the repo contents onto the runner so scripts and Quarto files are available.</p>
</section>
<section id="step-2-set-up-python" class="level3">
<h3 class="anchored" data-anchor-id="step-2-set-up-python">Step 2 — Set up Python</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Python</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-python@v5</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">"3.11"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Creates a Python 3.11 environment on the runner.</p>
</section>
<section id="step-3-install-python-dependencies" class="level3">
<h3 class="anchored" data-anchor-id="step-3-install-python-dependencies">Step 3 — Install Python dependencies</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install dependencies</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">  run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>   python -m pip install --upgrade pip</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>   python -m pip install \</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>     jupyter ipykernel nbformat \</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>     pandas numpy openpyxl \</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>     netCDF4 requests python-dateutil matplotlib cartopy \</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>     beautifulsoup4 lxml plotnine xarray</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Installs required Python libraries for:</p>
<ul>
<li>data handling (pandas, numpy, xarray, netCDF4)</li>
<li>HTTP + date handling (requests, python-dateutil)</li>
<li>scraping/parsing (beautifulsoup4, lxml)</li>
<li>plotting + mapping (matplotlib, cartopy, plotnine)</li>
<li>notebook-related utilities (included, though scripts appear to be .py)</li>
</ul>
</section>
<section id="step-4-install-quarto" class="level3">
<h3 class="anchored" data-anchor-id="step-4-install-quarto">Step 4 — Install Quarto</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Setup Quarto</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> quarto-dev/quarto-actions/setup@v2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Installs Quarto on the runner so the site can be rendered.</p>
</section>
<section id="data-update-scripts-what-gets-refreshed" class="level3">
<h3 class="anchored" data-anchor-id="data-update-scripts-what-gets-refreshed">Data update scripts (what gets refreshed)</h3>
<p>These steps run Python scripts that update dashboard data and derived outputs (plots/maps).</p>
</section>
<section id="step-5-run-total-update-controller" class="level3">
<h3 class="anchored" data-anchor-id="step-5-run-total-update-controller">Step 5 — Run TOTAL update controller</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Run TOTAL update controller</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python projects/turtlewatch/scripts/control_total_data_2025.py</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="control_total_data_2025.py-controller-script-overview" class="level4">
<h4 class="anchored" data-anchor-id="control_total_data_2025.py-controller-script-overview"><code>control_total_data_2025.py</code> (Controller Script Overview)</h4>
<p>This script is the top-level controller for the TurtleWatch TOTAL dashboard update pipeline. It checks the latest available MUR SST anomaly month on ERDDAP and compares it to the most recent local indicator CSV and monthly SST maps. If the website data is behind, it runs subordinate scripts (update_total_indicator_2025.py, plot_total_tool_2025.py, &amp; make_monthly_maps_2025.py) to update the indicator time series, regenerate the indicator plot, and create new monthly maps. After updates, it builds a small <code>web_data.json</code> file used by the dashboard to display alert status, forecast month, latest index value, and last update date. In short, it decides what needs updating and ensures the website data products stay synchronized with ERDDAP.</p>
</section>
</section>
<section id="step-6-scrape-enso-status" class="level3">
<h3 class="anchored" data-anchor-id="step-6-scrape-enso-status">Step 6 — Scrape ENSO status</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Scrape ENSO status</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python projects/turtlewatch/scripts/scape_elnino_2025.py</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="scape_elnino_2025.py-enso-scraper-overview" class="level4">
<h4 class="anchored" data-anchor-id="scape_elnino_2025.py-enso-scraper-overview"><code>scape_elnino_2025.py</code> (ENSO Scraper Overview)</h4>
<p>This script scrapes the NOAA Climate Prediction Center (CPC) website for the latest ENSO (El Niño/La Niña) advisory information, including the issue date, alert status, and synopsis text. It compares the scraped advisory date to the locally stored JSON file and only updates if a newer advisory is available (unless a custom date is specified). When new data is found, it writes a dated archive JSON file and updates the primary <code>elnino_last.json</code> file used by the website. The resulting JSON files are stored in <code>projects/turtlewatch/data/json/</code> and are read by the Quarto dashboard pages to display current ENSO status. In short, this script keeps the website’s ENSO advisory information synchronized with the CPC website.</p>
</section>
</section>
<section id="step-7-scrape-heatwave-status" class="level3">
<h3 class="anchored" data-anchor-id="step-7-scrape-heatwave-status">Step 7 — Scrape Heatwave status</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Scrape Heatwave status</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python projects/turtlewatch/scripts/update_heatwave_2025.py</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="update_heatwave_2025.py-heatwave-scraper-overview" class="level4">
<h4 class="anchored" data-anchor-id="update_heatwave_2025.py-heatwave-scraper-overview"><code>update_heatwave_2025.py</code> (Heatwave Scraper Overview)</h4>
<p>This script scrapes the NOAA PSL marine heatwaves page for the latest forecast date/period and the regional narrative summaries for the <strong>North Pacific</strong> and <strong>Tropical Pacific</strong>. It compares the newly scraped content (and parsed forecast date) against the existing local <code>heatwave.json</code> and updates the files if the date or text has changed (or if <code>--overwrite</code> is used). When an update is needed, it writes/overwrites <code>projects/turtlewatch/data/json/heatwave.json</code> and also saves a dated archive copy like <code>YYYYMM_heatwave.json</code> in the same folder. These JSON outputs are read by the TurtleWatch Quarto pages to display the current marine heatwave status text and metadata. In short, it keeps the website’s heatwave status block synchronized with NOAA PSL.</p>
</section>
</section>
<section id="step-8-update-closure-history-from-federal-register" class="level3">
<h3 class="anchored" data-anchor-id="step-8-update-closure-history-from-federal-register">Step 8 — Update closure history from Federal Register</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Update closure history from Federal Register</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">run</span><span class="kw">:</span><span class="at"> python projects/turtlewatch/scripts/update_Itca_closure.py</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="update_ltca_closure.py-ltca-closure-updater-overview" class="level4">
<h4 class="anchored" data-anchor-id="update_ltca_closure.py-ltca-closure-updater-overview"><code>update_ltca_closure.py</code> (LTCA Closure Updater Overview)</h4>
<p>This script queries the Federal Register API for new Pacific Loggerhead Conservation Area (LTCA) closure notices published by NOAA/NMFS. It filters results for relevant “loggerhead” or “highly migratory” closure announcements and compares them against the existing <code>ltca_closure.csv</code> file. Any new notices (based on missing URLs) are appended to the dataset, preserving existing records. The updated CSV is written to <code>projects/turtlewatch/data/resources/ltca_closure.csv</code>, which is used by the Quarto dashboard to display closure history. In short, it keeps the website’s closure dataset synchronized with the Federal Register without manual edits.</p>
</section>
</section>
<section id="rendering-the-website" class="level3">
<h3 class="anchored" data-anchor-id="rendering-the-website">Rendering the website</h3>
</section>
<section id="step-9-render-the-quarto-site" class="level3">
<h3 class="anchored" data-anchor-id="step-9-render-the-quarto-site">Step 9 — Render the Quarto site</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Render Quarto site (to docs/)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">run</span><span class="kw">:</span><span class="at"> quarto render</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Important behavior</strong>:</p>
<ul>
<li>Rendering produces the site output in docs/ (GitHub Pages typically serves from docs/ on the main branch).</li>
<li>Any .qmd pages that read from projects/turtlewatch/data/ will now incorporate the newly updated data.</li>
</ul>
</section>
<section id="committing-and-pushing-the-updated-outputs" class="level3">
<h3 class="anchored" data-anchor-id="committing-and-pushing-the-updated-outputs">Committing and pushing the updated outputs</h3>
</section>
<section id="step-10-commit-updated-files" class="level3">
<h3 class="anchored" data-anchor-id="step-10-commit-updated-files">Step 10 — Commit updated files</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Commit updated docs outputs</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">  run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    git config user.name "github-actions[bot]"</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    git config user.email "github-actions[bot]@users.noreply.github.com"</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    git add docs/ projects/turtlewatch/data/</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    git commit -m "Automated dashboard update" || echo "No changes to commit"</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    git push origin HEAD:main</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">GITHUB_TOKEN</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>What this does:</p>
<ul>
<li>Sets a bot identity for the commit.</li>
<li>Stages the rendered website output (docs/) and the updated dashboard data (projects/turtlewatch/data/).</li>
<li>Commits with message “Automated dashboard update”.</li>
<li>If nothing changed, it prints “No changes to commit” and continues.</li>
<li>Pushes the commit directly to main.</li>
</ul>
<p>Why GITHUB_TOKEN is included: GitHub provides a built-in token so the workflow can authenticate to push changes back to the repo.</p>
</section>
<section id="what-to-expect-after-it-runs" class="level3">
<h3 class="anchored" data-anchor-id="what-to-expect-after-it-runs">What to expect after it runs</h3>
<p>After a successful workflow run:</p>
<ul>
<li>projects/turtlewatch/data/ should contain updated data products (CSV/JSON/etc.)</li>
<li>docs/ should contain updated rendered HTML and updated images/assets</li>
<li>The live GitHub Pages site should reflect new data after Pages finishes serving the updated docs/</li>
</ul>
</section>
</section>
<section id="common-troubleshooting" class="level2">
<h2 class="anchored" data-anchor-id="common-troubleshooting">Common troubleshooting</h2>
<section id="the-actions-run-succeeds-but-the-website-doesnt-change" class="level4">
<h4 class="anchored" data-anchor-id="the-actions-run-succeeds-but-the-website-doesnt-change">The Actions run succeeds but the website doesn’t change</h4>
<ul>
<li>GitHub Pages may take a minute to serve the new docs/ output.</li>
<li>Confirm the commit was pushed to main and includes docs/ changes.</li>
</ul>
</section>
<section id="the-actions-run-fails-during-scraping" class="level4">
<h4 class="anchored" data-anchor-id="the-actions-run-fails-during-scraping">The Actions run fails during scraping</h4>
<ul>
<li>The external site may have changed HTML structure or blocked the runner.</li>
<li>Check the Actions logs for the failing script and update selectors/URLs.</li>
</ul>
</section>
<section id="the-actions-run-fails-during-quarto-render" class="level4">
<h4 class="anchored" data-anchor-id="the-actions-run-fails-during-quarto-render">The Actions run fails during quarto render</h4>
<ul>
<li>Quarto may be missing system dependencies (rare, but mapping libraries can require system packages).</li>
<li>Verify the render works locally; if it only fails in Actions, the runner may need additional apt packages.</li>
</ul>
</section>
<section id="no-changes-to-commit-but-you-expected-changes" class="level4">
<h4 class="anchored" data-anchor-id="no-changes-to-commit-but-you-expected-changes">No changes to commit (but you expected changes)</h4>
<ul>
<li>The script outputs may be written somewhere not included in:
<ul>
<li>git add docs/ projects/turtlewatch/data/</li>
</ul></li>
<li>Or the scripts may be writing to a path that’s ignored by .gitignore</li>
<li>Confirm file paths and where the Quarto pages read from.</li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<footer style="
  width: 100%;
  padding: 2rem 1rem;
  border-top: 1px solid #ddd;
  background: none;
  color: #333;
  font-size: 1.125rem;
">
  <div style="
    max-width: 1200px;
    margin: 0 auto;
  ">

    <!-- Top link bar -->
    <div style="
      display: flex;
      justify-content: space-evenly;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      white-space: nowrap;
    ">
      <a href="https://www.fisheries.noaa.gov/" style="color: #336699; text-decoration: none;">Fisheries</a>
      <a href="https://www.star.nesdis.noaa.gov/star/index.php" style="color: #336699; text-decoration: none;">STAR</a>
      <a href="https://coastwatch.noaa.gov/cwn/index.html" style="color: #336699; text-decoration: none;">CoastWatch</a>
      <a href="https://www.fisheries.noaa.gov/about/southwest-fisheries-science-center" style="color: #336699; text-decoration: none;">Southwest Fisheries</a>
      <a href="https://www.fisheries.noaa.gov/about/climate-and-ecosystems-program-southwest-fisheries-science-center" style="color: #336699; text-decoration: none;">Environmental Research Division</a>
    </div>

    <!-- Logo + tagline -->
    <div style="
      text-align: center;
      margin: 2rem 0;
    ">
      <img src="../images/noaa_logo.png" alt="NOAA logo" style="height: 56px; display: block; margin: 0 auto 0.5rem;">
      <div style="font-style: italic; color: #333;">Science. Service. Stewardship.</div>
    </div>

    <!-- Bottom legal links -->
    <div style="
      text-align: center;
      margin-bottom: 1.5rem;
      font-size: 1rem;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1rem 1.5rem;
    ">
      <a href="https://www.noaa.gov/protecting-your-privacy" style="color: #336699; text-decoration: none;">Protecting Your Privacy</a>
      <a href="https://www.noaa.gov/information-technology/foia" style="color: #336699; text-decoration: none;">FOIA</a>
      <a href="https://www.noaa.gov/information-technology" style="color: #336699; text-decoration: none;">Information Quality</a>
      <a href="https://www.noaa.gov/disclaimer" style="color: #336699; text-decoration: none;">Disclaimer</a>
      <a href="https://www.commerce.gov/" style="color: #336699; text-decoration: none;">Commerce.gov</a>
    </div>

    <!-- Final credit line -->
    <div style="
      text-align: center;
      font-size: 0.9rem;
      color: #666;
    ">
      © 2025 NOAA CoastWatch West Coast | Built with <a href="https://quarto.org" style="color: #336699; text-decoration: none;">Quarto</a>
    </div>

  </div>
</footer>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>