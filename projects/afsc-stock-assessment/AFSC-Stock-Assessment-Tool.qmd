---
anchor-sections: false
format:
  html:
    toc: false
    page-layout: full
    css: ../../styles.css
resources:
  - spreadsheets/**
---

:::{.afsc-page}

::: {.afsc-columns}
::: {.afsc-column}
## AFSC Stock Assessment Tool
![](images/chl_zones.png){fig-align="center" width="100%"}

<label for="datasetSelect"><strong>Select a Parameter:</strong></label></br>
<select id="datasetSelect" class="btn-noaa">
  <option value="chlorophyll" selected>Chlorophyll</option>
  <option value="sst">Sea Surface Temperature</option>
  <option value="wind">Wind Speeds</option>
</select>

:::

::: {.afsc-column}

<!-- Dynamic dataset title -->
<div id="dataset-title" style="margin-top: 1em;">
  <h2>ESA CCI Ocean Color Data</h2>
</div>

<div id="chlorophyll" class="dataset-info">
  <dl class="dataset-details">
    <dt>Summary</dt>
    <dd>Merge chlorophyll data from the MODIS Aqua, VIIRS, MERIS, and SeaWiFS sensors.</dd>
    <dt>Source</dt>
    <dd>Ocean Colour Program, European Space Agency</dd>
    <dt>Temporal Coverage</dt>
    <dd>1997-09-04T00:00:00Z – 2018-06-01T00:00:00Z</dd>
    <dt>Time Series Data</dt>
    <dd><a href="https://polarwatch.noaa.gov/erddap/search/index.html?searchFor=afsc_chlorophyll">AFSC Chlorophyll Time Series</a></dd>
    <dt>Satellite Data</dt>
    <dd><a href="https://coastwatch.pfeg.noaa.gov/erddap/griddap/pmlEsaCCI31OceanColorMonthly.graph">ESA CCI Ocean Color Monthly</a></dd>
    <dt>More Information</dt>
    <dd><a href="http://www.esa-oceancolour-cci.org/">ESA Ocean Colour CCI Project Website</a></dd>
  </dl>
</div>

<div id="sst" class="dataset-info" style="display:none;">
  <dl class="dataset-details">
    <dt>Summary</dt>
    <dd>Sea surface temperature data from AVHRR sensors.</dd>
    <dt>Source</dt>
    <dd>NOAA NCEI</dd>
    <dt>Coverage</dt>
    <dd>1981-09-16T00:00:00Z – 2019-06-16T00:00:00Z</dd>
    <dt>Time Series Data</dt>
    <dd><a href="https://polarwatch.noaa.gov/erddap/search/index.html?searchFor=afsc_sst" target="_blank">
      AFSC SST Time Series
    </a></dd>
    <dt>Satellite Data</dt>
    <dd><a href="https://coastwatch.pfeg.noaa.gov/erddap/griddap/erdPH53sstnmday.graph" target="_blank">
      AVHRR Pathfinder Version 5.3 SST Monthly
    </a></dd>
    <dt>More Information</dt>
    <dd><a href="https://data.nodc.noaa.gov/cgi-bin/iso?id=gov.noaa.nodc:AVHRR_Pathfinder-NCEI-L3C-v5.3" target="_blank">
       AVHRR Pathfinder Version 5.3 Product Page
    </a></dd>
  </dl>
</div>

<div id="wind" class="dataset-info" style="display:none;">
  <dl class="dataset-details">
    <dt>Summary</dt>
    <dd>NOAA Blended Winds (1987–2011), MetOp ASCAT (2011–present).</dd>
    <dt>Source</dt>
    <dd>NOAA NCEI / NOAA NESDIS</dd>
    <dt>Coverage</dt>
    <dd>1987-07-15T00:00:00Z – 2019-09-16T00:00:00Z</dd>
    <dt>Time Series Data</dt>
    <dd><a href="https://polarwatch.noaa.gov/erddap/search/index.html?searchFor=afsc_wind" target="_blank">
      AFSC Wind Speed Time Series
    </a></dd>
    <dt>Satellite Data</dt>
    <dd>
      <a href="https://coastwatch.pfeg.noaa.gov/erddap/griddap/ncdcOwMon.graph" target="_blank">
        NOAA NCDC Blended Wind Monthly
      </a><br>
      <a href="https://coastwatch.pfeg.noaa.gov/erddap/griddap/erdQBdivmodmday.graph" target="_blank">
        Metop-B ASCAT Wind Divergence Monthly
      </a>
    </dd>
    <dt>More Information</dt>
    <dd>
      <a href="https://www.ncei.noaa.gov/products/blended-sea-winds" target="_blank">
        NOAA NCDC Blended Sea Winds Data Access
      </a><br>
      <a href="https://www.ospo.noaa.gov/Products/atmosphere/ascat/" target="_blank">
        ASCAT Products Page
      </a>
    </dd>
  </dl>
</div>

:::
:::

## Plots for Each AFSC Management Region

<div class="dashboard-grid">
  <div id="dashboard1"><div id="chart_div1"></div><div id="filter_div1"></div></div>
  <div id="dashboard2"><div id="chart_div2"></div><div id="filter_div2"></div></div>
  <div id="dashboard3"><div id="chart_div3"></div><div id="filter_div3"></div></div>
  <div id="dashboard4"><div id="chart_div4"></div><div id="filter_div4"></div></div>
  <div id="dashboard5"><div id="chart_div5"></div><div id="filter_div5"></div></div>
  <div id="dashboard6"><div id="chart_div6"></div><div id="filter_div6"></div></div>
  <div id="dashboard7"><div id="chart_div7"></div><div id="filter_div7"></div></div>
  <div id="dashboard8"><div id="chart_div8"></div><div id="filter_div8"></div></div>
</div>

<script src="https://www.gstatic.com/charts/loader.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.21/jquery.csv.min.js"></script>

<script>
// ----------------- Setup -----------------
google.charts.load('current', {packages:['corechart','controls']});
google.charts.setOnLoadCallback(init);

let dashboards = []; 
let currentDataset = "chlorophyll";

const datasetFiles = {
  chlorophyll: "spreadsheets/afsc_chlorophyll.csv",
  sst: "spreadsheets/afsc_sst.csv",
  wind: "spreadsheets/afsc_wind.csv"
};
const datasetUnits = {
  chlorophyll: "Chl (mg m⁻³)",
  sst: "SST (°C)",
  wind: "Wind Speed (m/s)"
};
const datasetTitles = {
  chlorophyll: "Chlorophyll",
  sst: "Sea Surface Temperature",
  wind: "Wind Speeds"
};
const datasetHeadings = {
  chlorophyll: "ESA CCI Ocean Color Data",
  sst: "AVHRR Pathfinder SST v5.3",
  wind: "Blended Sea Winds / ASCAT Winds"
};
const regionNames = [
  "Northern Bering Sea (NBS)",
  "Southern Bering Sea (SBS)",
  "Western Gulf of Alaska (WGA)",
  "Central Gulf of Alaska (CGA)",
  "Eastern Gulf of Alaska (EGA)",
  "Western Aleutian Islands (WAI)",
  "Central Aleutian Islands (CAI)",
  "Eastern Aleutian Islands (EAI)"
];

// ----------------- Init -----------------
function init() {
  loadDataset(currentDataset);
  updateInfo(currentDataset);

  document.getElementById("datasetSelect").addEventListener("change", function() {
    currentDataset = this.value;
    loadDataset(currentDataset);
    updateInfo(currentDataset);
  });
}

// ----------------- Info Panel -----------------
function updateInfo(datasetKey) {
  document.querySelectorAll(".dataset-info").forEach(div => div.style.display = "none");
  document.getElementById(datasetKey).style.display = "block";

  // Update dynamic title
  document.getElementById("dataset-title").innerHTML = "<h2>" + datasetHeadings[datasetKey] + "</h2>";
}

// ----------------- Plot Loader -----------------
function loadDataset(datasetKey) {
  $.ajax({
    url: datasetFiles[datasetKey],
    dataType: "text"
  }).done(function(csvText) {
    let rows = $.csv.toArrays(csvText);
    let headers = rows[0];
    rows = rows.slice(1);

    let dataArray = rows.map(r => {
      let row = [new Date(r[0])];
      for (let i = 1; i < headers.length; i++) {
        row.push(parseFloat(r[i]) || null);
      }
      return row;
    });

    let allData = [ ["Date"].concat(headers.slice(1)) ].concat(dataArray);

    dashboards = [];
    for (let i = 1; i <= 8; i++) {
      dashboards.push(drawRegionDashboard(i, headers[i], regionNames[i-1], allData, datasetKey));
    }
  });
}

// ----------------- Draw Chart -----------------
function drawRegionDashboard(colIndex, colName, regionTitle, allData, datasetKey) {
  let data = new google.visualization.DataTable();
  data.addColumn('date', 'Date');
  data.addColumn('number', colName);

  for (let r = 1; r < allData.length; r++) {
    data.addRow([allData[r][0], allData[r][colIndex]]);
  }

  let idx = colIndex; 
  let dashboard = new google.visualization.Dashboard(
    document.getElementById("dashboard" + idx)
  );

  let control = new google.visualization.ControlWrapper({
    controlType: 'ChartRangeFilter',
    containerId: "filter_div" + idx,
    options: {
      filterColumnIndex: 0,
      ui: {
        chartType: 'LineChart',
        chartOptions: { height: 60, chartArea: {width: '80%'} }
      }
    }
  });

  let chart = new google.visualization.ChartWrapper({
    chartType: 'ScatterChart',
    containerId: "chart_div" + idx,
    options: {
      height: 250,
      chartArea: {width: '80%', height: '70%'},
      hAxis: {title: 'Date'},
      vAxis: {title: datasetUnits[datasetKey]},
      interpolateNulls: true,
      trendlines: {0: {type:'linear', color:'green', lineWidth:2, opacity:0.5}},
      legend: 'none',
      title: "Mean Monthly " + datasetTitles[datasetKey] + " - " + regionTitle
    }
  });

  dashboard.bind(control, chart);
  dashboard.draw(data);

  return {dashboard, data};
}

// ----------------- Redraw on resize -----------------
window.addEventListener('resize', function() {
  dashboards.forEach(d => {
    if (d && d.dashboard && d.data) d.dashboard.draw(d.data);
  });
});
</script>

:::